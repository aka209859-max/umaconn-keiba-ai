# NAR AI予想システム

地方競馬（NAR）全14場の予想を自動生成するAIシステム

## 特徴

- **31ファクター**: 単独16 + 組み合わせ15
- **競馬場別重み付け**: 各競馬場の特性を反映
- **AAS得点方式**: 相対評価による高精度予想
- **3種類の出力**: 基本予想、note投稿用、プレミアムTOP10

## プロジェクト構造

```
nar-ai-yoso/
├── config/
│   ├── db_config.py          # DB接続設定
│   ├── course_master.py      # コース分類・直線距離・コーナー回数
│   └── factor_weights.py     # 競馬場別ファクター重み
├── core/
│   ├── data_fetcher.py       # データ取得
│   ├── aas_calculator.py     # AAS得点計算
│   └── prediction_generator.py # 予想生成・TXT出力
├── main.py                    # メインスクリプト
├── requirements.txt           # 依存パッケージ
└── README.md                  # このファイル
```

## セットアップ

### 1. 依存パッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. データベース設定

`config/db_config.py` を編集してPostgreSQLの接続情報を設定:

```python
DB_CONFIG = {
    'host': '127.0.0.1',
    'port': 5432,
    'user': 'postgres',
    'password': 'YOUR_PASSWORD',  # ← 実際のパスワードに変更
    'dbname': 'pckeiba'
}
```

### 3. データベース接続テスト

```bash
python config/db_config.py
```

## 使用方法

### 基本的な使用方法

```bash
# 明日の予想を生成
python main.py

# 特定の日付の予想を生成
python main.py 20260106
```

### 出力先

```
E:/UmaData/nar-analytics-python/predictions/YYYYMMDD/
├── 大井_01R.txt              # 基本予想（レースごと）
├── 大井_02R.txt
├── ...
├── note/
│   ├── 大井競馬_全レース.txt  # note投稿用
│   └── ...
└── premium/
    └── 高期待値_TOP10.txt     # プレミアムコンテンツ
```

## 使用ファクター（31項目）

### 単独ファクター（16項目）

1. 前走着順
2. 前走1コーナー順位
3. 前走2コーナー順位
4. 前走3コーナー順位
5. 前走4コーナー順位
6. 前走タイム差
7. 前走上がり3F
8. 馬番
9. 枠番
10. 性別
11. 馬体重
12. 馬体重増減
13. 馬齢
14. 調教師
15. 騎手
16. 出走頭数

### 組み合わせファクター（15項目）

1. 騎手×枠番
2. 前走距離×今走距離
3. 馬場状態×枠番
4. 条件コード×前走条件コード
5. 前走着順×前走4コーナー順位
6. 前走着順×前走上がり3F
7. 騎手×前走着順
8. 性別×距離
9. 馬齢×前走着順
10. 枠番×前走枠番
11. 騎手×調教師
12. コース分類
13. 回り（左/右）
14. 直線距離×前走上がり3F
15. コーナー回数×前走コーナー順位

## 競馬場別の特性

### 広い・タフ（差し・追い込み有利）
- 門別、盛岡、大井（外回り1600m以上）

### 小回り・先行有利
- 浦和、金沢、笠松、名古屋、園田、佐賀

### 内枠超有利
- 大井、川崎

### フラット・実力通り
- 船橋

## AAS得点計算方式

```
1. 各ファクターの補正回収率データ取得
2. Hit_raw = 0.65 × 単勝的中率 + 0.35 × 複勝的中率
3. Ret_raw = 0.35 × 単勝回収率 + 0.65 × 複勝回収率
4. レース内でZスコア化
5. AAS得点 = 12 × tanh(0.55×ZH + 0.45×ZR) × Shrinkage
6. 競馬場別重みを適用
7. 全ファクターの得点を合計
```

## 除外競馬場

- 帯広（ばんえい）: 特殊な競技形態のため除外

## TODO

- [ ] 補正回収率計算ロジックの統合（既存システムから）
- [ ] バックテスト機能の実装
- [ ] 的中率・回収率の集計機能
- [ ] タスクスケジューラ設定（毎日20:00自動実行）

## 開発者

Enable CEO

## ライセンス

Private

## 更新履歴

- 2026-01-04: 初版リリース
