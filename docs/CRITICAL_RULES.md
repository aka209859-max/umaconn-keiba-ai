# ⚠️ **絶対遵守ルール - CRITICAL RULES**

**作成日**: 2026-01-09  
**重要度**: 🔴 **最高** - このルールに違反した場合は即座に作業を中止すること

---

## 🔥 **CEO指示の絶対ルール**

### **ルール1: 憶測・推測の完全禁止**

**❌ 禁止事項**:
- ロジック以外で憶測や推測を使用すること
- 実データが存在するのに推定値を使用すること
- CEOに確認せずに独自判断で推定値を作成すること

**✅ 必須対応**:
```
憶測や推測で進めようとする場合：
「これは憶測になりますが、よろしいですか？」と必ず確認すること
```

**このルールはファイルに保存されています**: `docs/CRITICAL_RULES.md`

---

### **ルール2: 基準タイムは実データのみ**

**❌ 禁止**: 基準タイムを推定値・憶測で設定すること

**✅ 正しい方法**: JRDB資料に基づいた実データの基準タイムを使用

**CEOから提供された資料**:
- JRDB指数体系の構造的解析と戦略的応用に関する包括的研究報告書
- 基準クラス: 4歳1勝クラス（旧500万下クラス）の平均パフォーマンス
- 単位: 指数の「1」= 0.1秒 = 約0.5馬身

**現在の問題**:
- `config/base_times.py` は推定値で設定されている（ルール違反）
- 実データから計算する必要がある

---

### **ルール3: 指数は実数値で保存**

**❌ 禁止**: 指数を10/20/30などの丸め値で保存すること

**✅ 正しい方法**: 指数は実数（小数点含む）で保存すること

**例**:
- ❌ 間違い: `ten_index = 10, 20, 30`
- ✅ 正しい: `ten_index = 12.5, 23.7, 31.2`

**確認事項**:
- データベースに保存されている指数値が実数かどうかを確認する
- 10刻みの値は統計分析用のグループ化のみに使用する

---

### **ルール4: マイナスは悪い、プラスは良い**

**❌ 禁止**: 指数値がマイナスで良いとされる設計

**✅ 正しい方法**: 全ての指数で以下のルールを遵守

```
マイナス値 = 悪いパフォーマンス
ゼロ値 = 基準（4歳1勝クラスの平均）
プラス値 = 良いパフォーマンス
```

**現在の問題**:
- テン指数: -100が最優秀値（ルール違反）
- 上がり指数: -100が最優秀値（ルール違反）
- 位置指数: 10が最優秀値（これは正しい）

**修正が必要**: テン指数と上がり指数の符号を反転させる

---

## 🔴 **現在の重大な問題点**

### **問題1: 基準タイムが推定値**

**現状**: `config/base_times.py` は手作業で設定した推定値

```python
# config/base_times.py（現在）
BASE_TIMES = {
    '42': {  # 大井競馬場
        1200: {'zenhan_3f': 34.5, 'kohan_3f': 37.8},  # ← 推定値（ルール違反）
    }
}
```

**修正方法**: JRDB資料に基づいた実データの基準タイムを使用

---

### **問題2: 指数が10刻みで保存されている**

**現状**: データベースに10/20/30で保存

```sql
-- 現在のデータ
index_value = '10', '20', '30', '40', '50', ...  -- ルール違反
```

**修正方法**: 実数値で保存する

```sql
-- 正しいデータ
ten_index = 12.5, 23.7, 31.2, ...  -- 実数値
```

---

### **問題3: テン指数・上がり指数の符号が逆**

**現状**: マイナス値が良いパフォーマンス

```
ten指数:   -100（最優秀値）← ルール違反
agari指数: -100（最優秀値）← ルール違反
```

**修正方法**: 符号を反転

```
ten指数:   +100（最優秀値）← 正しい
agari指数: +100（最優秀値）← 正しい
```

---

## ✅ **修正アクションプラン**

### **優先度1: 基準タイムの修正**

**憶測確認**: 
```
現在の基準タイムは推定値です。
実データから計算する必要がありますが、これは憶測になりますか？
それとも実データから統計的に計算するため問題ありませんか？
```

**CEOの承認を得てから実行**:
```bash
python scripts/calculate_base_times_from_real_data.py
```

---

### **優先度2: 指数の符号修正**

**テン指数・上がり指数の計算ロジックを修正**:

```python
# 現在（間違い）
ten_index = ((base_time - zenhan_3f) + corrections) * 10

# 修正後（正しい）
ten_index = ((zenhan_3f - base_time) + corrections) * 10
```

**修正方法**: `core/index_calculator.py` の計算式を修正

---

### **優先度3: 実数値で保存**

**データベーススキーマの修正**:

```sql
-- 現在のスキーマ（間違い）
CREATE TABLE nar_hqs_index_stats (
    index_value VARCHAR(10),  -- '10', '20', '30'...
    ...
);

-- 修正後のスキーマ（正しい）
CREATE TABLE nar_hqs_index_data (
    ten_index FLOAT,      -- 12.5, 23.7, 31.2...
    position_index FLOAT,
    agari_index FLOAT,
    pace_index FLOAT,
    ...
);
```

---

## 🎯 **CEOへの確認事項**

### **質問1: 基準タイムの計算について**

**現状**: 基準タイムは推定値（ルール違反）

**修正案**: 実データから統計的に平均値を計算

**確認**: これは憶測になりますか？それとも問題ありませんか？

---

### **質問2: 指数の符号反転について**

**現状**: テン指数・上がり指数がマイナスで良い（ルール違反）

**修正案**: 計算式の符号を反転してプラスが良い形に修正

**確認**: この修正でよろしいですか？

---

### **質問3: データベース構造の変更について**

**現状**: 指数を10刻みで保存（ルール違反）

**修正案**: 実数値で保存するようにスキーマを変更

**確認**: データベース構造を変更してよろしいですか？

---

## 📋 **今後の開発プロセス**

**新ルール**: 憶測が必要な場合は必ず確認

```
開発者: 「これは憶測になりますが、よろしいですか？」
↓
CEOの承認: 「OK」または「NG」
↓
承認された場合のみ実行
```

**このルールを遵守することで**:
- 推定値の使用を最小限に抑える
- 実データベースの開発を徹底
- CEOの意図通りのシステムを構築

---

**Play to Win. 🔥**
