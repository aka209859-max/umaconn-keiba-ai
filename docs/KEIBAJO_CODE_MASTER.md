# 地方競馬 競馬場コードマスター

## 作成日時
- 作成日: 2026-01-08
- 作成者: AI戦略家（CSO兼クリエイティブディレクター）
- 目的: 地方競馬競馬場コードの最終確定版

---

## 📋 競馬場コード一覧（NAR地方競馬）

### 現役開催中（13競馬場）

| コード | 競馬場名 | 地域 | データ収集期間 | 理由 |
|--------|----------|------|----------------|------|
| 30 | 門別（北海道） | 北海道 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 35 | 盛岡（岩手） | 東北 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 36 | 金沢（石川） | 北陸 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 42 | 大井（東京） | 南関東 | 2023-10-01 〜 2025-12-31 | 砂変更後 |
| 43 | 川崎（神奈川） | 南関東 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 44 | 船橋（千葉） | 南関東 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 45 | 浦和（埼玉） | 南関東 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 46 | 笠松（岐阜） | 東海 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 47 | 名古屋（愛知） | 東海 | 2022-04-01 〜 2025-12-31 | 大幅改修後 |
| 48 | 園田（兵庫） | 近畿 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 49 | 姫路（兵庫） | 近畿 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 50 | 高知（高知） | 四国 | 2016-01-01 〜 2025-12-31 | 長期データ |
| 54 | 佐賀（佐賀） | 九州 | 2016-01-01 〜 2025-12-31 | 長期データ |

### 除外対象

| コード | 競馬場名 | 除外理由 |
|--------|----------|----------|
| 83 | 帯広（ばんえい） | ダート競走と異なる特性（ばんえい競走） |

### 廃止済み（参考）

| コード | 競馬場名 | 備考 |
|--------|----------|------|
| 55 | 佐賀（旧コード） | 現在は 54 を使用 |
| 61 | 旭川 | 廃止済み |
| 62 | 北見 | 廃止済み |
| 65 | ばんえい（旧コード） | 現在は 83 を使用 |

---

## 🎯 HQS実績データ収集の対象競馬場

### Pattern A: 砂変更後（1競馬場）
```python
SAND_CHANGE_TRACKS = {
    '42': {  # 大井
        'name': '大井',
        'start_date': '20231001',
        'end_date': '20251231',
        'reason': 'オーストラリア産白砂への全面置換'
    }
}
```

### Pattern B: 大幅改修後（1競馬場）
```python
RENOVATION_TRACKS = {
    '47': {  # 名古屋
        'name': '名古屋',
        'start_date': '20220401',
        'end_date': '20251231',
        'reason': '大幅改修実施'
    }
}
```

### Pattern C: 長期データ（11競馬場）
```python
STANDARD_TRACKS = {
    '30': '門別（北海道）',
    '35': '盛岡（岩手）',
    '36': '金沢（石川）',
    '43': '川崎（神奈川）',
    '44': '船橋（千葉）',
    '45': '浦和（埼玉）',
    '46': '笠松（岐阜）',
    '48': '園田（兵庫）',
    '49': '姫路（兵庫）',
    '50': '高知（高知）',
    '54': '佐賀（佐賀）'
}
```

### 除外対象
```python
EXCLUDED_TRACKS = {
    '83': '帯広（ばんえい）',  # ばんえい競走は除外
}
```

---

## 📊 データベース定義との整合性確認

### nvd_ra テーブル
- カラム: `keibajo_code` (TEXT)
- 値の範囲: '30', '35', '36', '42', '43', '44', '45', '46', '47', '48', '49', '50', '54', '83'

### nvd_se テーブル
- カラム: `keibajo_code` (TEXT)
- 値の範囲: nvd_ra と同じ

### nar_si_race_results テーブル
- カラム: `keibajo_code` (TEXT)
- 値の範囲: nvd_ra と同じ

### nar_hqs_index_stats テーブル（新規作成）
- カラム: `keibajo_code` (CHAR(2))
- 値の範囲: '30', '35', '36', '42', '43', '44', '45', '46', '47', '48', '49', '50', '54'
- **除外**: '83'（ばんえい）

---

## 🚨 重要な注意事項

### 1. 高知最終レースの除外
- **条件**: `keibajo_code = '50' AND race_bango = '12'`
- **理由**: データ品質の問題（欠損が多い）

### 2. ばんえい競走の除外
- **条件**: `keibajo_code = '83'`
- **理由**: ダート競走と異なる特性（そり引き競走）

### 3. 佐賀競馬のコード統一
- **旧コード**: '55'
- **現行コード**: '54'
- **対応**: データベース内では '54' を使用

---

## 📝 SQL除外条件（標準テンプレート）

```sql
-- NAR地方競馬データ取得時の標準WHERE句
WHERE keibajo_code IN ('30','35','36','42','43','44','45','46','47','48','49','50','54')
  AND keibajo_code != '83'  -- ばんえい除外
  AND NOT (keibajo_code = '50' AND race_bango = '12')  -- 高知最終レース除外
```

---

## ✅ 最終確定事項

1. **競馬場コードは全てTEXT型で2桁の文字列**
2. **集計対象は13競馬場**（30, 35, 36, 42, 43, 44, 45, 46, 47, 48, 49, 50, 54）
3. **除外対象は1競馬場**（83: ばんえい）
4. **データ収集期間は競馬場ごとに異なる**（上記Pattern A/B/C参照）

---

## 🎯 次のアクション

CEO環境で以下を実行してください：

### 1. テーブル作成
```bash
E:
cd \UmaData\nar-analytics-python-v2
psql -U postgres -d pckeiba -f scripts\create_hqs_index_stats_table.sql
```

### 2. データ収集実行
```bash
python scripts\collect_index_stats.py
```

### 3. 結果確認
```sql
SELECT 
    keibajo_code,
    index_type,
    COUNT(*) as record_count,
    SUM(cnt_win) as total_races
FROM nar_hqs_index_stats
GROUP BY keibajo_code, index_type
ORDER BY keibajo_code, index_type;
```

---

**Play to Win. 10x Mindset. 48時間で確信に変えましょう！** 🚀
