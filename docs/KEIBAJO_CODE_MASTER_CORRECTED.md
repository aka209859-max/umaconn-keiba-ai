# 地方競馬 競馬場コードマスター（修正版）

## 作成日時
- 作成日: 2026-01-09
- 修正日: 2026-01-09
- 作成者: AI戦略家（CSO兼クリエイティブディレクター）
- 目的: 地方競馬競馬場コードの最終確定版（公式発表に基づく）

---

## 📋 競馬場コード一覧（NAR地方競馬）

### 現役開催中（14競馬場）

| コード | 競馬場名 | 所在地 | 略名 | 英字名 | データ収集期間 | 理由 |
|--------|----------|--------|------|--------|----------------|------|
| 30 | 門別 | 北海道 | 門 | MONBETSU | 2016-01-01 〜 2025-12-31 | 長期データ |
| 35 | 盛岡 | 岩手県 | 盛 | MORIOKA | 2016-01-01 〜 2025-12-31 | 長期データ |
| 36 | 水沢 | 岩手県 | 水 | MIZUSAWA | 2016-01-01 〜 2025-12-31 | 長期データ |
| **42** | **浦和** | 埼玉県 | 浦 | URAWA | 2016-01-01 〜 2025-12-31 | 長期データ |
| **43** | **船橋** | 千葉県 | 船 | FUNABASHI | 2016-01-01 〜 2025-12-31 | 長期データ |
| **44** | **大井** | 東京都 | 大 | OHI | 2023-10-01 〜 2025-12-31 | 砂変更後 |
| **45** | **川崎** | 神奈川県 | 川 | KAWASAKI | 2016-01-01 〜 2025-12-31 | 長期データ |
| 46 | 金沢 | 石川県 | 金 | KANAZAWA | 2016-01-01 〜 2025-12-31 | 長期データ |
| 47 | 笠松 | 岐阜県 | 笠 | KASAMATSU | 2016-01-01 〜 2025-12-31 | 長期データ |
| 48 | 名古屋 | 愛知県 | 古 | NAGOYA | 2022-04-01 〜 2025-12-31 | 大幅改修後 |
| 50 | 園田 | 兵庫県 | 園 | SONODA | 2016-01-01 〜 2025-12-31 | 長期データ |
| 51 | 姫路 | 兵庫県 | 姫 | HIMEJI | 2016-01-01 〜 2025-12-31 | 長期データ |
| 54 | 高知 | 高知県 | 高 | KOCHI | 2016-01-01 〜 2025-12-31 | 長期データ |
| 55 | 佐賀 | 佐賀県 | 佐 | SAGA | 2016-01-01 〜 2025-12-31 | 長期データ |

### 除外対象

| コード | 競馬場名 | 除外理由 |
|--------|----------|----------|
| 33 | 帯広（ばんえい） | ダート競走と異なる特性（ばんえい競走） |

---

## 🚨 重要な修正事項

### 南関東4場のコード修正

**❌ 間違い（修正前）:**
```
42: 大井
43: 川崎
44: 船橋
45: 浦和
```

**✅ 正しい（修正後）:**
```
42: 浦和 ✅
43: 船橋 ✅
44: 大井 ✅
45: 川崎 ✅
```

---

## 🎯 HQS実績データ収集の対象競馬場

### Pattern A: 砂変更後（1競馬場）
```python
SAND_CHANGE_TRACKS = {
    '44': {  # 大井（修正: 42 → 44）
        'name': '大井',
        'start_date': '20231001',
        'end_date': '20251231',
        'reason': 'オーストラリア産白砂への全面置換'
    }
}
```

### Pattern B: 大幅改修後（1競馬場）
```python
RENOVATION_TRACKS = {
    '48': {  # 名古屋
        'name': '名古屋',
        'start_date': '20220401',
        'end_date': '20251231',
        'reason': '大幅改修実施'
    }
}
```

### Pattern C: 長期データ（12競馬場）
```python
STANDARD_TRACKS = {
    '30': '門別（北海道）',
    '35': '盛岡（岩手）',
    '36': '水沢（岩手）',
    '42': '浦和（埼玉）',  # 修正: 大井 → 浦和
    '43': '船橋（千葉）',  # 修正: 川崎 → 船橋
    '45': '川崎（神奈川）',  # 修正: 浦和 → 川崎
    '46': '金沢（石川）',
    '47': '笠松（岐阜）',
    '50': '園田（兵庫）',
    '51': '姫路（兵庫）',
    '54': '高知（高知）',
    '55': '佐賀（佐賀）'
}
```

### 除外対象
```python
EXCLUDED_TRACKS = {
    '33': '帯広（ばんえい）',  # ばんえい競走は除外
}
```

---

## 📊 データベース定義との整合性確認

### nvd_ra テーブル
- カラム: `keibajo_code` (TEXT)
- 値の範囲: '30', '35', '36', '42', '43', '44', '45', '46', '47', '48', '50', '51', '54', '55'

### nvd_se テーブル
- カラム: `keibajo_code` (TEXT)
- 値の範囲: nvd_ra と同じ

### nar_hqs_index_stats テーブル（新規作成）
- カラム: `keibajo_code` (CHAR(2))
- 値の範囲: '30', '35', '36', '42', '43', '44', '45', '46', '47', '48', '50', '51', '54', '55'
- **除外**: '33'（ばんえい）

---

## 🚨 重要な注意事項

### 1. 高知最終レースの除外
- **条件**: `keibajo_code = '54' AND race_bango = '12'`
- **理由**: データ品質の問題（欠損が多い）

### 2. ばんえい競走の除外
- **条件**: `keibajo_code = '33'`
- **理由**: ダート競走と異なる特性（そり引き競走）

### 3. 佐賀競馬のコード
- **コード**: '55' または '54'
- **対応**: データベース内では '55' を使用（'54'は高知）

---

## 📝 SQL除外条件（標準テンプレート）

```sql
-- NAR地方競馬データ取得時の標準WHERE句
WHERE keibajo_code IN ('30','35','36','42','43','44','45','46','47','48','50','51','54','55')
  AND keibajo_code != '33'  -- ばんえい除外
  AND NOT (keibajo_code = '54' AND race_bango = '12')  -- 高知最終レース除外
```

---

## ✅ 最終確定事項

1. **競馬場コードは全てTEXT型で2桁の文字列**
2. **集計対象は14競馬場**（30, 35, 36, 42, 43, 44, 45, 46, 47, 48, 50, 51, 54, 55）
3. **除外対象は1競馬場**（33: ばんえい）
4. **データ収集期間は競馬場ごとに異なる**（上記Pattern A/B/C参照）
5. **南関東4場のコードは公式発表に基づき修正済み**

---

## 🎯 次のアクション

CEO環境で以下を実行してください：

### 1. 正しい競馬場コードで大井の1200mを確認
```bash
cd E:\UmaData\nar-analytics-python-v2
python scripts\check_correct_ooi_1200m.py
```

### 2. すべてのスクリプトの競馬場コードを修正
- `calculate_base_times_from_real_data_v6.py`
- その他の競馬場コードを参照しているスクリプト

### 3. ドキュメントの更新
- `docs/KEIBAJO_CODE_MASTER.md` を本ファイルで置換

---

**Play to Win. 10x Mindset. 48時間で確信に変えましょう！** 🚀
