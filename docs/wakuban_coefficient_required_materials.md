# 位置指数の枠順係数ディープサーチ：添付資料リスト

## 📋 概要

このドキュメントは、枠順係数の学術的最適化のために必要な資料をリストアップしたものです。

---

## ✅ 既に取得済みの資料

### **1. 枠順別的中率データ**
- **ファイル名**: `data-1768033229370.csv`
- **場所**: `/home/user/uploaded_files/data-1768033229370.csv`
- **内容**: 全14競馬場×26距離×8枠番の単勝/複勝的中率（796行）
- **カラム**:
  - `keibajo_code`: 競馬場コード
  - `keibajo_name`: 競馬場名
  - `distance`: 距離（m）
  - `waku`: 枠番（1-8）
  - `sample_count`: サンプル数
  - `start_date`: 集計開始日
  - `end_date`: 集計終了日
  - `tansho_hit_rate`: 単勝的中率（%）
  - `fukusho_hit_rate`: 複勝的中率（%）

**✅ この資料は十分です。追加提供不要。**

---

### **2. 枠順係数の算出結果**
- **ファイル名**: `wakuban_coefficients.csv`
- **場所**: `/home/user/webapp/nar-ai-yoso/data/wakuban_coefficients.csv`
- **内容**: 全競馬場×距離×枠番別の枠順係数（796行）
- **カラム**:
  - `keibajo_code`, `keibajo_name`, `distance`, `waku`
  - `sample_count`: サンプル数
  - `tansho_hit_rate`, `fukusho_hit_rate`: 的中率
  - `avg_hit_rate`: 平均的中率
  - `baseline_rate`: 基準値（全枠平均）
  - `wakuban_coefficient`: 枠順係数

**✅ この資料は十分です。追加提供不要。**

---

### **3. 枠順係数の算出ロジック**
- **ファイル名**: `calculate_wakuban_coefficients.py`
- **場所**: `/home/user/webapp/nar-ai-yoso/scripts/calculate_wakuban_coefficients.py`
- **内容**: 現行の枠順係数算出ロジック（単純な平均的中率差分方式）

**✅ この資料は十分です。追加提供不要。**

---

### **4. 位置指数の計算ロジック**
- **ファイル名**: `index_calculator.py`
- **場所**: `/home/user/webapp/nar-ai-yoso/core/index_calculator.py`
- **関数**: `calculate_position_index` (行390-441)
- **内容**: 位置指数の計算式と枠順補正の適用方法

**✅ この資料は十分です。追加提供不要。**

---

## 🔍 追加で必要な資料（CEOに依頼）

### **5. レース結果の詳細データ（高優先度）**

#### **目的**
- ベイズ統計、GLM、機械学習による枠順係数の推定
- サンプル数を考慮した統計的有意性の検証
- 交互作用項（枠×距離、枠×競馬場）の推定

#### **必要なカラム**
| カラム名 | 説明 | 必須 | データ型 | 例 |
|---------|------|------|---------|-----|
| `race_id` | レースID | ✅ | 文字列 | "20250110_30_01" |
| `keibajo_code` | 競馬場コード | ✅ | 整数 | 30（門別） |
| `kyori` | 距離（m） | ✅ | 整数 | 1200 |
| `wakuban` | 枠番 | ✅ | 整数 | 1-8 |
| `chakujun` | 着順 | ✅ | 整数 | 1-12 |
| `tosu` | 出走頭数 | ✅ | 整数 | 12 |
| `baba_code` | 馬場状態コード | ⚪ | 文字列 | "1"（良） |
| `grade_code` | クラスコード | ⚪ | 文字列 | "A", "E" |
| `tansho_flag` | 単勝的中フラグ | ⚪ | 整数 | 0 or 1 |
| `fukusho_flag` | 複勝的中フラグ | ⚪ | 整数 | 0 or 1 |

#### **データ量の目安**
- **最低**: 10,000レース（約80,000出走）
- **推奨**: 50,000レース（約400,000出走）
- **理想**: 全期間（2016年〜2025年）のデータ

#### **データ形式**
- **CSV形式** または **データベース（SQLite/PostgreSQL等）**
- エンコーディング: UTF-8
- 欠損値: 空文字列または "NULL"

#### **データの場所**
```
例1: E:\UmaData\race_results.csv
例2: E:\UmaData\nar_data.db（SQLiteデータベース）
```

---

### **6. 競馬場のコース情報（中優先度）**

#### **目的**
- 競馬場の特性（コース形状、直線距離等）を考慮した枠順係数の推定
- 逃げ有利/差し有利の競馬場で枠順の影響が異なることを検証

#### **必要な情報**
| カラム名 | 説明 | 例 |
|---------|------|-----|
| `keibajo_code` | 競馬場コード | 30（門別） |
| `keibajo_name` | 競馬場名 | "門別" |
| `chokusen_kyori` | 直線距離（m） | 200 |
| `corner_count` | コーナー数 | 4 |
| `course_type` | コース形状 | "左回り", "右回り" |
| `nige_yuri` | 逃げ有利度 | "高", "中", "低" |
| `sashi_yuri` | 差し有利度 | "高", "中", "低" |

#### **データ形式**
- **CSV形式** または **手動入力（14競馬場のみ）**

---

### **7. 過去の予測精度データ（低優先度）**

#### **目的**
- 現行の枠順係数の精度を定量的に評価
- 新方式との比較基準を設定

#### **必要な情報**
- 過去の予測結果（予測順位 vs 実際の着順）
- 単勝的中率、複勝的中率、回収率
- 期間: 最低1年分

#### **データ形式**
- **CSV形式** または **集計済みの統計値**

---

## 📂 推奨データ提供順序

### **Phase 1: 最小限のデータで開始（即座に実行可能）**
- ✅ 既に取得済みの資料（1〜4）で、**ベイズ統計による推定**を実装
- サンプル数を考慮した信頼区間付き枠順係数を算出
- 予測精度の改善を確認

### **Phase 2: レース結果データを追加（高精度化）**
- 📂 資料5（レース結果の詳細データ）を追加
- 一般化線形モデル（GLM）や機械学習による推定を実装
- 交互作用項（枠×距離、枠×競馬場）の効果を検証

### **Phase 3: コース情報を追加（さらなる精度向上）**
- 📂 資料6（競馬場のコース情報）を追加
- 逃げ有利/差し有利の競馬場で枠順係数を調整
- 競馬場特性を考慮した高精度モデルを構築

---

## 🎯 CEO への依頼

### **Q1: レース結果データの有無**
以下のいずれかを選択してください。

- **A) 持っている** → データパスを教えてください
- **B) 一部持っている** → 何年分のデータがあるか教えてください
- **C) 持っていない** → Phase 1（既存データのみ）で進めます

### **Q2: データ提供のタイミング**
- **即座に提供可能** → すぐに高精度化に進みます
- **後で提供** → Phase 1（ベイズ統計）を先に実装します

---

## 📋 添付資料チェックリスト

| # | 資料名 | 優先度 | 状態 | 備考 |
|---|--------|--------|------|------|
| 1 | 枠順別的中率データ | 高 | ✅ 取得済み | `data-1768033229370.csv` |
| 2 | 枠順係数の算出結果 | 高 | ✅ 生成済み | `wakuban_coefficients.csv` |
| 3 | 枠順係数の算出ロジック | 高 | ✅ 実装済み | `calculate_wakuban_coefficients.py` |
| 4 | 位置指数の計算ロジック | 高 | ✅ 実装済み | `index_calculator.py` |
| 5 | レース結果の詳細データ | 高 | ⏳ CEO提供待ち | CSV or DB |
| 6 | 競馬場のコース情報 | 中 | ⏳ CEO提供待ち | CSV or 手動入力 |
| 7 | 過去の予測精度データ | 低 | ⏳ CEO提供待ち | CSV or 統計値 |

---

## ✅ 次のアクション

### **CEO が「A) データを持っている」を選択した場合**
1. データパスを教えてください
2. データ形式（CSV/DB）を教えてください
3. すぐに Phase 2（高精度化）に進みます

### **CEO が「C) データを持っていない」を選択した場合**
1. Phase 1（ベイズ統計）で既存データのみを使用
2. 信頼区間付き枠順係数を算出
3. 精度改善を確認後、CEO判断により Phase 2 に進むか決定

---

**Play to Win! 🚀**
