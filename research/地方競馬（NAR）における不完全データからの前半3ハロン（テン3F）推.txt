地方競馬（NAR）における不完全データからの前半3ハロン（テン3F）推定手法に関する包括的調査報告書1. 序論：地方競馬データにおける「盲点」とその克服日本の競馬産業において、日本中央競馬会（JRA）と地方競馬全国協会（NAR）の間には、提供されるデータ粒度に顕著な格差が存在します。JRAが全レースにおいて200mごとのラップタイムや、近年ではトラッキングシステムによる詳細な位置情報を提供する一方で、多くの地方競馬場では依然として「走破タイム（Total Time）」「上がり3F（Last 3F）」「各コーナー通過順位（Corner Passing Order）」の3点のみが、ペース分析の拠り所となる計時データです。本報告書は、この「情報の非対称性」を解消し、データサイエンスの観点から欠損している「前半3ハロン（テン3F）」の数値を理論的かつ統計的に逆算・推定する手法を体系化したものです。テン3Fは、ダート競馬において勝敗を分ける決定的要因である「先行力（Senkou-ryoku）」や「基礎スピード」を数値化する上で不可欠な指標です。この値が欠落したままでは、予測モデルは後半のパフォーマンス（末脚）のみを過大評価する「差しバイアス」に陥りやすく、レースの本質的な展開（ペースメイク）を見誤る危険性があります。本調査では、物理学的な運動方程式、統計的相関モデル、そして幾何学的な位置推定アルゴリズムを融合させ、レース映像やラップタイムが存在しない環境下でも、高精度にテン3Fを復元する「多層的推定モデル」を提案します。2. 理論的枠組み：走破タイムと区間タイムの運動学的関係テン3Fを推定するための第一歩は、競走馬の運動を物理的な方程式として定義することにあります。レース距離が1200mを超える場合、未知数は「前半」と「中盤」の2つに増えるため、単純な引き算では解を導き出せません。ここでは、その理論的限界を突破するための枠組みを提示します。2.1 競走時間の構成要素と「ブラックボックス」問題任意の距離 $D$ における走破タイム $T_{total}$ は、以下の3つのフェーズの総和として定義されます。$$T_{total} = T_{start(3F)} + T_{middle} + T_{last(3F)}$$ここで、我々が利用可能な変数は $T_{total}$ と $T_{last(3F)}$ のみです。したがって、未知の変数である「前半3F（$T_{start}$）」を求める式は以下のように変形されます。$$T_{start(3F)} + T_{middle} = T_{total} - T_{last(3F)}$$この右辺（$T_{total} - T_{last(3F)}$）は、レースの「ラスト3F地点に到達するまでの所要時間」を示しており、本報告書ではこれを**「先行区間タイム（Pre-Last Time）」**と定義します。1200m戦の場合:中間区間（$T_{middle}$）が存在しない（または極めて短い）ため、理論上は以下の式が成立します。$$T_{start(3F)} \approx T_{total} - T_{last(3F)}$$ただし、ゲート発走から計測開始までの「助走区間」の扱いが競馬場により異なる場合があるため、微小な補正項 $\epsilon$ が必要となりますが、基本的には確定値として逆算可能です。1300m以上の場合:$T_{middle}$ が発生するため、先行区間タイムを「前半3F」と「中盤」に分解するロジックが必要となります。この分解こそが、本課題の核心である「ブラックボックス問題」です。2.2 ダート競馬におけるエネルギー消費と速度減衰モデル地方競馬の主戦場であるダートコースは、芝コースと比較して路盤の摩擦係数が高く（砂厚8〜12cm）、走行には莫大なエネルギーを要します1。この物理的特性は、競走馬のペース配分（Pacing Strategy）に特有のバイアスをもたらします。初期加速のコスト: ダート戦では、砂の抵抗に打ち勝ち、かつ後続からのキックバック（蹴り上げられた砂）を避けるために、スタート直後に最大出力でポジションを確保する必要があります。したがって、前半3Fはレース全体の中で相対的に速くなる傾向があります（ハイペース傾向）。中盤の「息入れ」: 前半で蓄積された乳酸を処理し、ラストスパートに備えるため、中盤区間（$T_{middle}$）では意図的な減速が行われます。終盤の消耗戦: 芝レースのような「瞬発戦（上がり勝負）」になることは少なく、多くの場合は減速しながらゴールになだれ込む「消耗戦（持久戦）」となります2。この生理学的・物理学的特性から、ダート長距離戦における速度プロファイル $V(t)$ は、一様な分布ではなく、前半にピークを持つ「右肩下がり（Decay）」の分布、あるいは中盤で谷を作る「U字型（または中弛み）」の分布をとることが推測されます。この知見は、単純な平均速度による按分ではなく、「前半加重型」の配分モデルを採用する理論的根拠となります。2.3 PCI（ペースチェンジ指数）を用いた展開構造の推定未知の中盤ペースを推定する上で、強力な理論的ツールとなるのが**PCI（Pace Change Index）およびRPCI（Race Pace Change Index）**の概念です2。PCIは、上がり3Fの速度と、それ以前の区間の平均速度の比率を示す指標です。$$PCI = \frac{\text{上がり3Fの平均速度}}{\text{上がり3F地点までの平均速度}} \times 50 + 50$$(※TARGET等のツールで用いられる一般的な定義に基づく簡略化)PCI < 50（持久戦）: 上がり3Fの速度が、前半〜中盤の速度よりも遅い状態。これは「前半に激しいペースで飛ばした結果、最後はバテてしまった」ことを示唆します。ダート競馬では頻繁に見られるパターンです。PCI > 60（瞬発戦）: 上がり3Fの速度が、前半よりも圧倒的に速い状態。前半が極端なスローペースで流れたことを意味します。逆算への応用ロジック:もし、対象レースのPCI構造を推定できれば、前半3Fを特定できます。「どうやってPCIを知るのか？」という問いに対しては、**「類似レースの統計」**を使用します。同条件（コース、距離、クラス）の過去レースにおける平均RPCI（レース全体のPCI）が「48.0」であれば、そのレースも同様のペース配分で流れた可能性が高いと仮定できます。$$\text{推定前半速度} \approx \text{後半速度} \times \frac{100 - \text{平均RPCI}}{\text{平均RPCI}}$$この関係式を用いることで、単なる距離按分よりも実態に即した「前半3F」を導出する理論的基盤が確立されます。3. 距離別・馬場状態別の前半3F比率統計モデル理論モデルを実装レベルに落とし込むためには、具体的なパラメータが必要です。ここでは、距離と馬場状態（良、稍重、重、不良）が前半3Fのタイムに与える影響を統計的にモデル化します。3.1 基準タイム（Standard Time）を用いたベースライン設定「西田式スピード指数」などの先行研究3において、各競馬場・距離ごとに設定される「基準タイム」は、テン3F推定の強力なアンカー（錨）となります。基準タイムとは、そのクラスにおける平均的な走破タイムであり、多くの場合、基準となる前半3Fタイムも設定されています。推定式（モデルA）：基準タイム比率法ある距離 $D$ における基準走破タイムを $T_{std\_total}$、基準テン3Fを $T_{std\_3F}$ とします。対象馬の走破タイムが $T_{actual}$ である場合、その馬のテン3F $T_{est\_3F}$ は、基準タイムからの偏差を用いて以下のように表現できます。$$T_{est\_3F} = T_{std\_3F} + (T_{actual} - T_{std\_total}) \times \alpha$$ここで $\alpha$ は「感度係数（Sensitivity Coefficient）」です。短距離（1200m以下）では、走破タイムの遅速はそのままテン3Fの遅速に直結するため、$\alpha \approx 1.0$ となります。中長距離（1600m以上）では、走破タイムの変動は中盤の緩みや上がりの脚に依存することが多いため、$\alpha$ は小さくなります（例: $0.3 \sim 0.5$）。3.2 距離別減衰係数（Distance Decay Factor）距離が延びるにつれて、騎手はスタミナ温存のために意図的に前半のペースを落とします。この「ペースダウン率」は線形ではありません。距離区分前半3Fの特性中盤の特性推定モデルの方向性スプリント (〜1300m)全力疾走（Max Velocity）なし（ほぼゼロ）減算モデル: $T_{total} - T_{last3F}$マイル (1400〜1600m)高速巡航（High Cruise）短い息入れ加重配分モデル: 前半重視中距離 (1700〜1900m)コントロール下（Controlled）長い巡航均等配分モデル: 平均速度に近い長距離 (2000m〜)スロー（Slow）駆け引きPCI依存モデル: 上がりとの逆相関統計的発見:1400m戦においては、多くの地方競馬場で「テン3F ≒ 上がり3F」または「テン3F < 上がり3F（テンの方が速い）」という現象（前傾ラップ）が観測されます。一方、1800m戦では「テン3F > 上がり3F（テンの方が遅い）」となる後傾ラップが一般的です。この転換点（Break-even Point）を特定することで、補正係数を決定します。3.3 馬場状態（Track Condition）による補正アルゴリズム日本のダート競馬における馬場状態の影響は、直感に反する挙動を示します1。良馬場（Dry/Standard）: 砂が乾燥してサラサラしており、脚が埋まるため抵抗が大きい。→ タイムは遅くなる（特にテン3F）。重・不良（Wet/Sloppy）: 水分を含んで砂が締まり、反発力が得やすくなる。→ タイムは速くなる（高速化）。この特性は、西田式スピード指数の馬場指数計算3において、馬場が渋る（水分を含む）ごとにタイムを減算補正することからも裏付けられます。馬場補正係数 $\beta_{cond}$ の導入:推定モデルにおいて、馬場状態 $C$ に応じた補正項を導入します。$$T_{est\_final} = T_{est\_base} \times \beta_{cond}(C)$$良馬場（Standard）: $\beta = 1.00$稍重（Good）: $\beta = 0.995$重（Muddy）: $\beta = 0.985$不良（Sloppy）: $\beta = 0.980$この係数は、水分を含んで締まった馬場ほど、スタートダッシュのエネルギー効率が良くなり、前半3Fが大幅に短縮される傾向を反映しています。特に地方競馬の深い砂（例えば高知競馬場など）では、この補正が極めて重要になります。4. コーナー通過順位を利用した前半ペース推定手法ここまでの統計モデルは「レース全体の平均」や「距離特性」に基づくマクロな推定でした。しかし、個々の馬が実際に刻んだラップは、その馬の位置取りに依存します。ここで、地方競馬データにおける最大の武器である**「コーナー通過順位（Corner Passing Order）」**を活用します。これは、映像がない環境下における唯一の「空間座標データ」です。4.1 「1馬身＝0.2秒」則の幾何学的応用と拡張競馬の経験則として「1馬身差は約0.2秒」とされています4。これを応用し、先頭馬（逃げ馬）との位置関係から、後続馬のタイムを逆算します。基本アルゴリズム（Leader-Reference Method）：基準点の設定: 第1コーナー（または第2コーナー）で通過順位が「1」の馬を特定します。この馬を「基準馬（Leader）」とします。基準タイムの推定: 基準馬のテン3Fは、そのレースのクラス基準タイムに、当日の馬場差を加味したものと仮定します（逃げ馬のタイム≒レースのペース）。相対タイムの算出: 任意の馬 $i$ の第1コーナー順位 $R_{c1}$ を用いて、先頭とのタイム差 $\Delta t_i$ を計算します。$$\Delta t_i = (R_{c1} - 1) \times \lambda$$ここで $\lambda$ は「1順位あたりのタイム差係数」です。単純な「1馬身=0.2秒」を適用する場合、$\lambda = 0.2$ となりますが、これには注意が必要です。4.2 群密度（Pack Density）による係数 $\lambda$ の動的調整レースの序盤（第1コーナー）において、馬群は必ずしも1馬身ずつ綺麗に整列しているわけではありません。密集状態（Dense Pack）: 10頭が一団となっている場合、1位と10位の差は2秒（10馬身）もなく、おそらく1秒（5馬身）程度です。この場合、$\lambda \approx 0.1$ となります。縦長状態（Strung Out）: ペースが速く縦長になった場合、1馬身以上の間隔が開くため、$\lambda \approx 0.3$ となることもあります。この「群密度」を推定するために、**RPCI（前述のレースペース指数）**を再利用します。RPCIが低い（ハイペース・消耗戦） $\rightarrow$ 縦長になりやすい $\rightarrow$ $\lambda$ を大きく設定。RPCIが高い（スローペース・瞬発戦） $\rightarrow$ 団子状態になりやすい $\rightarrow$ $\lambda$ を小さく設定。4.3 位置取りの変化（Position Delta）とエネルギーコストさらに高度な分析として、コーナー間の順位変動（Position Delta）を考慮します。例えば、ある馬の通過順位が「10-10-3-1」であったとします。第3コーナーでの急浮上（10 $\rightarrow$ 3）: いわゆる「まくり（Maku-ri）」です。この馬は、中盤区間（$T_{middle}$）において、他馬よりも圧倒的に速いラップを刻んでいます。したがって、走破タイムから逆算する際、中盤に多くの時間を割り当てる（＝中盤が速い）ため、相対的に前半3Fは遅かったと推定できます。逆に、「3-3-10-10」のように失速（Tare）した馬の場合、中盤までは速いペースで追走していたが、最後のアガリ3Fで歩いてしまったと解釈できます。この場合、走破タイムは遅くても、推定されるテン3Fは「速い」数値を与えなければなりません。このロジックは、5にある「位置取りの有利不利（Position Bias）」や「不均等なペース配分」を定量化するものです。5. 海外競馬における類似事例と解決策日本独自の課題と思われがちな「セクショナルタイムの欠如」ですが、海外競馬（特に英・愛・米の地方トラック）においても同様の課題が存在し、歴史的に洗練された解決策が開発されています。5.1 英国：Timeform社の「Finishing Speed %」英国Timeform社は、部分的な計時データからレース展開を読み解く指標として**「Finishing Speed %（FS%）」**を開発しました6。定義:$$FS_{\%} = \frac{\text{レース全体の平均速度}}{\text{上がり（Last Section）の平均速度}} \times 100$$(※注: 定義は文献により逆数や比率の取り方が異なるが、概念的には「終盤速度と全体速度の比」である)FS% > 100%: 上がりが全体平均より速い（スローペースからの瞬発戦）。FS% < 100%: 上がりが全体平均より遅い（ハイペース消耗戦）。この指標は、そのままNARのデータにも適用可能です。NARデータには「走破タイム」と「上がり3F」があります。全馬のFS%を計算します。レース全体の平均FS%（レースFS%）を算出します。レースFS%が「98%」などの低い値であれば、そのレースの「前半3F」は非常に速かったと推定されます。Timeformの手法は、絶対的な「秒数」を当てるのではなく、**「標準（Par）に対してどれだけ速かったか/遅かったか」**という相対評価を行う点で、不完全データ環境に極めて適応的です8。5.2 米国：Beyer Speed Figuresと「Points of Call」米国のダート競馬では、Beyer指数に代表されるスピード指数が主流です9。ここでも、小規模トラックではトラッキングシステムがありません。彼らの手法は、**「Points of Call（通過地点）」**ごとの先頭馬とのタイム差（Beaten Lengths）を手動で計算し、ペース数値を割り出すものです。示唆: 米国のハンデキャッパーは、公式タイムがない場合、コース上のランドマーク（ハロン棒）を通過する際の映像を目視して手動計測することすらありますが、データ分析の観点からは、「着差（Margin）」を厳密に時間換算するBeyerのアルゴリズム（特に、距離やコース表面による1馬身あたりの秒数換算テーブル）が参考になります。NARデータにおける「コーナー順位」を「Points of Call」と見なすことで、Beyer式のペース算出ロジックを転用可能です。6. 機械学習を用いた予測モデルと実装アルゴリズム現代のデータサイエンスにおいて、最も実用的なアプローチは、ルールベースの計算（決定論的モデル）と、機械学習によるパターン認識（確率論的モデル）の融合です。ここでは、NARデータに特化した機械学習パイプラインを提案します。6.1 欠損値補完（Imputation）としての定式化本課題は、機械学習の文脈では**「回帰問題（Regression）」あるいは「欠損値補完（Imputation）」**として定義されます10。目的変数（Target Variable） $Y$:正解データのあるレース（交流重賞やJRAデータ）における「前半3Fタイム」。説明変数（Features） $X$:走破タイム関連: $T_{total}$, $T_{last3F}$, $T_{total} - T_{last3F}$レース条件: 距離（正規化済み）, 馬場状態（カテゴリ変数 $\rightarrow$ 数値化）, 頭数位置情報: 第1コーナー順位, 第2, 第3, 第4コーナー順位位置変動: $R_{c4} - R_{c1}$ （ポジションを上げたか下げたか）派生特徴量:Pre-Last Speed: $(Distance - 600) / (T_{total} - T_{last3F})$Last Speed: $600 / T_{last3F}$Speed Ratio: Pre-Last Speed / Last Speed6.2 アルゴリズムの選択：KNN vs LightGBM先行研究10に基づき、以下の2つのアプローチが有効です。k-近傍法（k-Nearest Neighbors, KNN）による類似検索:ロジック: 「似たようなタイムで走り、似たような位置取りをし、似たような上がりを使った馬は、似たようなテン3Fで走ったはずである」。実装: 全過去データ（正解ラベル付き）の中から、特徴量ベクトルが最も近い $k$ 個の事例を探し、そのテン3Fの平均値を予測値とします。利点: 局所的な相関関係（例えば「高知競馬場の不良馬場1400m」という特殊条件）を捉えやすい。勾配ブースティング決定木（LightGBM / XGBoost）:ロジック: 変数間の非線形な相互作用（例：距離が1400mかつ重馬場の場合のみ、コーナー順位の影響度が変わるなど）を学習します。実装: 大規模なデータセットで回帰モデルを学習させます。利点: 予測精度が高く、欠損データ（例えば第3コーナーの順位がない等）の扱いにも長けています12。6.3 実装可能なアルゴリズム（Python風擬似コード）ユーザーが即座に実装できるよう、ルールベースと統計モデルを組み合わせたハイブリッド・アルゴリズムを提示します。Pythondef estimate_nar_ten3f(race_data, standard_times):
    """
    地方競馬データからテン3Fを推定する関数
    
    Args:
        race_data (dict): {
            'distance': int,       # 距離 (m)
            'total_time': float,   # 走破タイム (sec)
            'last_3f': float,      # 上がり3F (sec)
            'corner_1': int,       # 第1コーナー順位
            'track_cond': int      # 馬場 (1:良, 2:稍, 3:重, 4:不)
        }
        standard_times (dict): 距離・馬場ごとの基準テン3Fマップ
        
    Returns:
        float: 推定テン3Fタイム
    """
    
    D = race_data['distance']
    T_total = race_data['total_time']
    T_last = race_data['last_3f']
    R_c1 = race_data['corner_1']
    
    # 1. 物理的限界による単純計算（スプリント戦）
    if D <= 1200:
        # 1200m以下は中盤がないため、単純減算が最も高精度
        # ただし、スタートロス補正（約1.0秒）等の微調整項を含める場合あり
        return T_total - T_last

    # 2. 中長距離戦の推論
    # 先行区間（ラスト3F以外）のタイム
    T_pre_last = T_total - T_last
    Dist_pre_last = D - 600
    
    # 平均速度ベースの初期推定
    V_avg = D / T_total
    V_pre = Dist_pre_last / T_pre_last
    
    # ペース配分モデル（Distance Decay Model）
    # 距離が長いほど、中盤（Middle）が緩む = Pre-Lastの中でTen-3Fの比重が高まる
    # 統計的に導出した係数 beta (例: 1600mなら0.60) を使用
    
    # 基準タイムからの偏差アプローチ (Model C)
    std_key = f"{D}m_cond{race_data['track_cond']}"
    std_ten3f = standard_times.get(std_key, 37.0) # デフォルト37.0s
    
    # 位置取りによる補正 (Position Delta)
    # 先頭(1番手)とのタイム差を推定。1順位あたり0.2秒とする。
    # ※ 本来はレースの「縦長度」で0.2を可変させるのがベスト
    time_gap = (R_c1 - 1) * 0.20
    
    # 先頭馬の推定テン3F
    # レースの上がり3Fが速い(スロー)なら、先頭馬のテンは遅い。逆も然り。
    # 簡易的に、基準タイムをベースにレース全体のスピード指数で補正する
    race_speed_index = (standard_times['total_std'] - T_total) 
    # スピード指数が高い＝タイムが速いレースなら、テンも速い傾向
    leader_est_ten3f = std_ten3f - (race_speed_index * 0.3) 
    
    # 対象馬の推定テン3F
    my_est_ten3f = leader_est_ten3f + time_gap
    
    # 整合性チェック (Constraint Satisfaction)
    # 推定テン3F + 推定中盤 + 上がり3F = 走破タイム になっているか？
    # 中盤の速度が異常値（世界記録並み or 歩く速度）になっていないか確認
    
    return round(my_est_ten3f, 1)
このアルゴリズムは、統計的ベースライン（基準タイム）を出発点とし、個別のレース結果（走破タイム・上がり）と位置情報（コーナー順位）を用いて補正をかける「ベイズ推定」に近いアプローチをとっています。7. 結論と提言地方競馬（NAR）データにおける「テン3F」の欠損は、単純な算術計算（引き算）では解決できない、複雑な物理的・統計的推論を要する課題です。しかし、本報告書で示した以下の手法を統合することで、実用レベルの推定値を導出することは十分に可能です。1300mを境界線とするモデルの切り替え: スプリント戦における決定論的アプローチと、中長距離戦における確率論的アプローチの分離。空間プロキシとしてのコーナー順位: 「1馬身=0.2秒」則の動的な適用による、個体別のタイム差分（Delta）の算出。基準タイムとPCIの活用: レース全体の質（ハイレベル/ローレベル）とペース構造（前傾/後傾）をアンカーとした補正。機械学習による補完: KNNや勾配ブースティングを用いた、多変量相関に基づく帰納的推論。今後の展望:現在、一部の地方競馬場ではGPSトラッキングの導入実験が進んでいます。将来的には正解データ（Ground Truth）が増加することが予想されます。現段階で提案した推定モデルを運用しつつ、新たな正解データが得られるたびにモデルを再学習（Fine-tuning）させる「Human-in-the-loop」型のシステム構築が、最も賢明な実装戦略となるでしょう。本手法により算出された「推定テン3F」は、従来の「上がり3F偏重」の予想ロジックに革新をもたらし、埋もれていた「逃げ・先行馬」の真の能力を可視化する強力な武器となることを確信します。